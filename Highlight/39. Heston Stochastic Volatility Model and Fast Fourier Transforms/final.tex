\documentclass[11pt,a4paper]{article}

% ---------- Encodage / fontes ----------
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}

% ---------- Maths / mise en page ----------
\usepackage{amsmath,amssymb,amsfonts,mathtools,bm}
\usepackage[a4paper,margin=2.2cm]{geometry}
\usepackage{hyperref}
\hypersetup{colorlinks=true,linkcolor=black,urlcolor=blue,citecolor=black}
\numberwithin{equation}{section}
\allowdisplaybreaks

% ---------- Macros ----------
\newcommand{\E}{\mathbb{E}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\1}{\mathbf{1}}
\newcommand{\CF}{\varphi} % characteristic function
\newcommand{\FT}{\psi}     % Fourier transform of damped call
\newcommand{\Log}{\ln}
\newcommand{\dd}{\,\mathrm{d}}
\newcommand{\Szero}{S_0}

\title{Carr--Madan et Heston : d\'eveloppements complets et coh\'erents}
\author{}
\date{}

\begin{document}
\maketitle
\tableofcontents
\newpage

% =========================================================
\section{Partie I --- Transform\'ee de Fourier du call amorti (Carr--Madan)}
% =========================================================

\subsection{Cadre et notations}

Sous la mesure risque--neutre $\Q$ et un taux $r$ constant :
\begin{equation}\label{eq:price-start}
C(K,T) = e^{-rT}\,\E^\Q\!\left[(S_T-K)^+\right].
\end{equation}

On introduit :
\begin{equation}
Y \equiv \Log S_T, \qquad k \equiv \Log K, \qquad f_Y \text{ densit\'e de } Y .
\end{equation}

La fonction caract\'eristique de $Y$ est :
\begin{equation}\label{eq:phiY-def}
\CF_Y(u) = \E\!\left[e^{iuY}\right] = \int_{\R} e^{iuy}\, f_Y(y)\,\dd y .
\end{equation}

On d\'ecompose $Y$ en :
\begin{equation}\label{eq:Y-decomp}
Y = \Log \Szero + X_T , \qquad X_T \equiv \Log\!\left(\frac{S_T}{\Szero}\right) ,
\end{equation}
et on d\'efinit la c.f.\ du rendement relatif :
\begin{equation}\label{eq:phiT-def}
\CF_T(u) = \E\!\left[e^{iuX_T}\right] .
\end{equation}

De \eqref{eq:Y-decomp} il vient :
\begin{equation}\label{eq:phiY-phiT-link}
\CF_Y(u) = \Szero^{\,iu}\,\CF_T(u) .
\end{equation}

\subsection{Call en fonction du log--strike}

\begin{align}
C(k)
&= e^{-rT}\,\E\!\left[(e^{Y}-e^{k})^+\right] \nonumber\\
&= e^{-rT}\int_{\R}(e^{y}-e^{k})^+ f_Y(y)\,\dd y \nonumber\\
&= e^{-rT}\int_{k}^{+\infty} \big(e^{y}-e^{k}\big)\, f_Y(y)\,\dd y .
\label{eq:C-of-k}
\end{align}

\subsection{D\'efinition de la transform\'ee amortie}

Fixons un param\`etre d'amortissement $\alpha>0$. Pour chaque $\nu\in\R$ :
\begin{equation}\label{eq:psi-def}
\FT_T(\nu) \equiv \int_{\R} e^{i\nu k}\, e^{\alpha k}\, C(k)\,\dd k , \qquad
A \equiv \alpha+i\nu .
\end{equation}

On part de l'expression :
\begin{equation}
\psi_T(\nu)
= e^{-rT}\int_{-\infty}^{+\infty} e^{i\nu k}e^{\alpha k}
\left[\int_k^{+\infty}(e^{y}-e^{k})f_{S_T}(y)\,\dd y\right] \dd k .
\tag{1.13}
\end{equation}

\subsection*{2. Ajout d'une indicatrice}

On peut écrire l'intégrale interne sous forme intégrale sur $\R$ :
\[
\int_k^{+\infty}(e^{y}-e^{k})f(y)\,\dd y
= \int_{-\infty}^{+\infty}(e^{y}-e^{k})\,\1_{\{y\ge k\}}\,f(y)\,\dd y .
\]
Ainsi :
\[
\psi_T(\nu)
= e^{-rT}\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty}
e^{i\nu k}e^{\alpha k}(e^{y}-e^{k})\,\1_{\{y\ge k\}}\,f(y)\,\dd y\,\dd k .
\]

\subsection*{3. Domaine d'intégration}

La fonction indicatrice $\1_{\{y\ge k\}}$ définit le domaine :
\[
D = \{(k,y)\in\R^2:\ y\ge k\}.
\]
On peut paramétrer ce domaine de deux manières équivalentes :
\[
\begin{cases}
k\in(-\infty,+\infty), & y\in[k,+\infty),\\[4pt]
y\in(-\infty,+\infty), & k\in(-\infty,y].
\end{cases}
\]
C’est exactement la justification des bornes :
\[
k\in(-\infty,+\infty),\ y\in(k,+\infty)
\quad\Longleftrightarrow\quad
y\in(-\infty,+\infty),\ k\in(-\infty,y) .
\]

\subsection*{4. Conditions de permutation des intégrales}

On souhaite permuter les intégrales via Fubini--Tonelli. On vérifie :
\[
\iint_{D}\!\big|e^{i\nu k}e^{\alpha k}(e^{y}-e^{k})\big|\,f(y)\,\dd y\,\dd k
\le \iint_{D}\!\big(e^{y}e^{\alpha k}+e^{(\alpha+1)k}\big)\,f(y)\,\dd y\,\dd k .
\]
En intégrant en $k$ sur $(-\infty,y]$ :
\[
\int_{-\infty}^{y} e^{\alpha k}\,\dd k = \frac{e^{\alpha y}}{\alpha},
\qquad
\int_{-\infty}^{y} e^{(\alpha+1)k}\,\dd k = \frac{e^{(\alpha+1)y}}{\alpha+1}.
\]
On obtient alors :
\[
\iint_D |\cdot| \le 
\left(\frac{1}{\alpha}+\frac{1}{\alpha+1}\right)
\E\!\left[e^{(\alpha+1)Y}\right] ,
\]
qui est finie si $\alpha>0$ et $\E[e^{(\alpha+1)Y}]<\infty$. La permutation est justifiée.

\subsection*{5. Inversion de l’ordre d’intégration}

On échange les intégrales : $y$ extérieur, $k$ intérieur sur $(-\infty,y)$ :
\begin{equation}
\psi_T(\nu)
= e^{-rT}\int_{-\infty}^{+\infty}
\left[\int_{-\infty}^{y} e^{i\nu k}e^{\alpha k}(e^{y}-e^{k})\,\dd k\right]
f_{S_T}(y)\,\dd y .
\tag{1.14}
\end{equation}

\subsection*{6. Intégration sur $k$}

En intégrant d'abord en $k$ avec la borne sup\'erieure $y$ :
\begin{align}
\FT_T(\nu)
&= e^{-rT}\int_{\R}\left(\int_{-\infty}^{y} \big(e^{y} e^{Ak}- e^{(A+1)k}\big)\,\dd k\right) f_Y(y)\,\dd y .
\label{eq:psi-after-swap}
\end{align}
\paragraph{Premier terme.}
\[
\int_{-\infty}^{y} e^{y} e^{Ak}\,\dd k
= e^{y}\left[\frac{e^{Ak}}{A}\right]_{k=-\infty}^{k=y}
= \frac{e^{(A+1)y}}{A}.
\]
\paragraph{Second terme.}
\[
\int_{-\infty}^{y} e^{(A+1)k}\,\dd k
= \left[\frac{e^{(A+1)k}}{A+1}\right]_{k=-\infty}^{k=y}
= \frac{e^{(A+1)y}}{A+1}.
\]
En reportant :
\begin{align}
\FT_T(\nu)
&= e^{-rT}\int_{\R}\left(\frac{e^{(A+1)y}}{A}-\frac{e^{(A+1)y}}{A+1}\right) f_Y(y)\,\dd y \nonumber\\
&= \frac{e^{-rT}}{A(A+1)}\int_{\R} e^{(A+1)y} f_Y(y)\,\dd y .
\label{eq:psi-pre-phi}
\end{align}

\subsection{Identification avec la fonction caract\'eristique}

Comme $e^{(A+1)y}=e^{(\alpha+i\nu+1)y}=e^{i(\nu-i(\alpha+1))y}$ :
\begin{equation}\label{eq:phiY-shift}
\int_{\R} e^{(A+1)y} f_Y(y)\,\dd y=\CF_Y\!\big(\nu-i(\alpha+1)\big).
\end{equation}
Donc, avec \eqref{eq:psi-pre-phi} :
\begin{equation}\label{eq:psi-phiY}
\FT_T(\nu)=\frac{e^{-rT}}{A(A+1)}\,\CF_Y\!\big(\nu-i(\alpha+1)\big).
\end{equation}
Puis, via \eqref{eq:phiY-phiT-link} :
\begin{equation}\label{eq:psi-final-CM}
\boxed{\;
\psi_T(\nu)=
\frac{e^{-rT}}{(\alpha+i\nu)(\alpha+i\nu+1)}\,
\CF_T\!\big(\nu-i(\alpha+1)\big)\,
S_0^{\,i\nu+\alpha+1}
\;}
\end{equation}

% =========================================================
\section{Partie II --- Fonction caract\'eristique du mod\`ele de Heston}
% =========================================================

\subsection{Dynamique et variable log}

\[
\begin{cases}
\dd S_t = \mu S_t \, \dd t + \sqrt{v_t}\, S_t \, \dd W_t^{(1)}, \\[3pt]
\dd v_t = \kappa(\theta - v_t)\, \dd t + \sigma \sqrt{v_t} \, \dd W_t^{(2)}, \\[3pt]
\dd W_t^{(1)}\,\dd W_t^{(2)} = \rho \, \dd t .
\end{cases}
\]
Posons $X_t=\ln S_t$. Alors :
\[
\dd X_t = \Big(\mu - \tfrac{1}{2}v_t\Big)\dd t + \sqrt{v_t}\,\dd W_t^{(1)}.
\]
La fonction caract\'eristique cherch\'ee est :
\[
\CF_T(u)=\E\!\left[e^{iu(X_T-X_0)}\right]=\E\!\left[e^{iu\ln(S_T/S_0)}\right].
\]

\subsection{Feynman--Kac et ansatz affine}

D\'efinissons :
\[
f(u,t,x,v)=\E\!\left[e^{iu X_T}\mid X_t=x,\ v_t=v\right],\qquad f(u,T,x,v)=e^{iux}.
\]

\subsection{\'Equation backward (Kolmogorov/Feynman--Kac)}

\[
\partial_t f + \left(\mu - \frac{v}{2}\right) \partial_x f 
+ \kappa(\theta - v)\partial_v f 
+ \frac{1}{2} v \, \partial_{xx} f
+ \rho \sigma v^{1/2} \partial_{xv} f
+ \frac{1}{2}\sigma^2 v \, \partial_{vv} f = 0.
\]
On cherche une solution affine :
\[
f(u,t,x,v) = \exp\!\big(C(\tau) + D(\tau)v + iux\big), \qquad \tau = T - t .
\]
Alors :
\[
\partial_t f = -C'(\tau)f - D'(\tau) v f,\quad 
\partial_x f = i u f,\quad 
\partial_{xx} f = -u^2 f,\quad
\partial_v f = D f,\quad
\partial_{vv} f = D^2 f,\quad
\partial_{xv} f = i u D f.
\]
En substituant :
\[
[-C' - D'v] + 
\left(\mu - \frac{v}{2}\right)(iu)
+ \kappa(\theta - v)D
+ \frac{1}{2}v(-u^2)
+ \rho \sigma v(iuD)
+ \frac{1}{2}\sigma^2 v D^2 = 0.
\]

\subsection{Identification des termes}

Terme constant :
\[
-C' + iu\mu + \kappa\theta D = 0 
\quad \Rightarrow \quad 
\boxed{\,C'(\tau) = \kappa\theta D(\tau) + i u \mu\, .}
\]
Coefficient de $v$ :
\[
-D' - \kappa D - \frac{1}{2}(iu + u^2)
+ \rho \sigma i u D
+ \frac{1}{2}\sigma^2 D^2 = 0,
\]
d'o\`u
\begin{equation}\label{eq:riccati}
\boxed{\,D'(\tau) = \tfrac{1}{2}\sigma^2 D(\tau)^2 + (\rho\sigma i u - \kappa)D(\tau) + \tfrac{1}{2}(u^2 + iu)\, ,}
\end{equation}
avec conditions initiales $C(0)=0$, $D(0)=0$.

\subsection*{3. Explicit Solution of the Riccati Equation for $D(\tau)$}

\subsubsection*{3.1 Stationary Roots}
Consider the stationary quadratic equation:
\[
\tfrac12\sigma^2 z^2 + (\rho\sigma iu - \kappa)z + \tfrac12(u^2+iu)=0.
\]
Its roots are:
\[
z_{1,2}=\frac{b\pm d}{\sigma^2},\qquad b=\kappa-\rho\sigma iu,\quad d=\sqrt{\,b^2+\sigma^2(u^2+iu)\,}.
\]

\subsubsection*{3.2 Factorization and Separation of Variables}
Equation \eqref{eq:riccati} can be rewritten as:
\[
D'(\tau)=\frac{\sigma^2}{2}\,\big(D(\tau)-z_1\big)\big(D(\tau)-z_2\big).
\]
Separating variables:
\[
\frac{dD}{(D-z_1)(D-z_2)}=\frac{\sigma^2}{2}\,d\tau
=\frac{1}{z_1-z_2}\!\left(\frac{1}{D-z_1}-\frac{1}{D-z_2}\right)d\tau,
\]
where \(z_1-z_2=\dfrac{2d}{\sigma^2}\). Integration gives:
\[
\frac{1}{z_1-z_2}\Big[\ln|D-z_1|-\ln|D-z_2|\Big]=\frac{\sigma^2}{2}\tau+C
\ \Longrightarrow\
\ln\!\frac{D-z_1}{D-z_2}=d\,\tau+C'.
\]
Exponentiating:
\[
\frac{D(\tau)-z_1}{D(\tau)-z_2}=C_0\,e^{d\tau}.
\]

\subsubsection*{3.3 Initial Condition and Closed Form}
From \(D(0)=0\):
\[
C_0=\frac{z_1}{z_2}=\frac{b+d}{b-d}=\frac{1}{g},\qquad g:=\frac{b-d}{b+d}.
\]
Hence:
\[
\frac{D(\tau)-z_1}{D(\tau)-z_2}=\frac{1}{g}e^{d\tau}
\ \Longrightarrow\
D(\tau)=\frac{z_2 - z_1\,g\,e^{-d\tau}}{1-g\,e^{-d\tau}}.
\]
Substituting \(z_1=(b+d)/\sigma^2\), \(z_2=(b-d)/\sigma^2\), yields the compact form:
\[
\boxed{\
D(\tau)=\frac{b-d}{\sigma^2}\,\frac{1-e^{-d\tau}}{1-g\,e^{-d\tau}},\qquad
g=\frac{b-d}{b+d}.\
}
\]

\subsection{Computation of \(C(\tau)\)}

From \eqref{eq:Cprime}:
\[
C(\tau)=iu\,r\,\tau+\kappa\theta\int_0^\tau D(s)\,\dd s.
\]
With \(D(s)=\dfrac{b-d}{\sigma^2}\dfrac{1-e^{-ds}}{1-ge^{-ds}}\), define:
\[
I(\tau):=\int_0^\tau D(s)\,\dd s
=\frac{b-d}{\sigma^2}\int_0^\tau \frac{1-e^{-ds}}{1-ge^{-ds}}\,\dd s.
\]
\subsubsection*{4.1 Integration by Change of Variable}
Let \(y=e^{-ds}\), then \(ds=-(1/d)\,dy/y\), \(s=0\mapsto y=1\), \(s=\tau\mapsto y=e^{-d\tau}\):
\[
\int_0^\tau \frac{1-e^{-ds}}{1-ge^{-ds}}\,\dd s
=\frac{1}{d}\int_{e^{-d\tau}}^{1}\frac{1-y}{y(1-gy)}\,\dd y.
\]
Partial fraction decomposition:
\[
\frac{1-y}{y(1-gy)}=\frac{1}{y}+\frac{g-1}{1-gy}.
\]
Integration yields:
\[
\int\frac{1}{y}\,\dd y=\ln y,\qquad
\int\frac{g-1}{1-gy}\,\dd y=-\frac{g-1}{g}\ln(1-gy).
\]
Thus:
\[
\int_0^\tau \frac{1-e^{-ds}}{1-ge^{-ds}}\,\dd s
=\tau-\frac{1-g}{g\,d}\ln\!\left(\frac{1-ge^{-d\tau}}{1-g}\right).
\]
\subsubsection*{4.2 Simplified Form}
Since \(\dfrac{1-g}{g}=\dfrac{2d}{b-d}\), we obtain:
\[
I(\tau)=\frac{1}{\sigma^2}\Big[(b-d)\tau-2\ln\!\Big(\frac{1-ge^{-d\tau}}{1-g}\Big)\Big].
\]
Finally:
\[
\boxed{\
C(\tau)=iu\,r\,\tau+\frac{\kappa\theta}{\sigma^2}\Big[(b-d)\tau-2\ln\!\Big(\frac{1-ge^{-d\tau}}{1-g}\Big)\Big].\
}
\]

% =========================================================
\section{Partie III --- Substitution de Heston dans Carr--Madan}
% =========================================================

\[
f(u,T,s,v) = \exp\!\big(C(T) + D(T)v + ius\big).
\]

For \(s=\ln S_0\) and \(v_0=v_t\):
\[
\boxed{\
\phi_T(u)=\exp\!\Big(
iu(s+rT)
+\frac{v_0}{\sigma^2}(b-d)\frac{1-e^{-dT}}{1-ge^{-dT}}
+\frac{\kappa\theta}{\sigma^2}\Big[(b-d)T-2\ln\!\frac{1-ge^{-dT}}{1-g}\Big]
\Big),\
}
\]
with:
\[
b=\kappa-\rho\sigma iu,\qquad
d=\sqrt{\,b^2+\sigma^2(u^2+iu)\,},\qquad
g=\frac{b-d}{b+d}.
\]

\end{document}
